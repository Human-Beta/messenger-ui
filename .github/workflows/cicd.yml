name: UI client CI/CD

on: pull_request

permissions:
  contents: read

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
      - uses: actions/checkout@v3
      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 16.10.0
      - name: Install dependencies
        run: npm install
      - name: Cache node_modules
        uses: actions/cache@v3
        with:
          key: ${{ runner.os }}-node_modules
          path: ./node_modules/


#  TODO: configure
  test:
    runs-on: ubuntu-22.04
    needs: build

    steps:
      - name: It is the place for running the tests
        run: echo Unit tests


  pre-deploy:
    runs-on: ubuntu-22.04
    needs: test

    steps:
      - uses: actions/checkout@v3
      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 16.10.0
      - name: Use cached node_modules
        uses: actions/cache@v3
        with:
          key: ${{ runner.os }}-node_modules
          path: ./node_modules/
      - name: Prepare built files for deployment
        run: npm run build
      - name: Cache ./build folder
        uses: actions/cache@v3
        with:
          key: ${{ runner.os }}-build
          path: ./build/

  deploy:
    runs-on: ubuntu-22.04
    needs: pre-deploy

    steps:
      - uses: actions/checkout@v3
      - name: Use cached ./build folder
        uses: actions/cache@v3
        with:
          key: ${{ runner.os }}-build
          path: ./build/
      - run: ls -l ./build
      - run: echo ${{ secrets.SERVERLESS_ACCESS_KEY }}
#      - name: Install Node.js
#        uses: actions/setup-node@v3
#        with:
#          node-version: 16.10.0
#      - name: Deploy
#        uses: serverless/github-action@v3.1
#        env:
#          SERVERLESS_ACCESS_KEY: ${{ secrets.SERVERLESS_ACCESS_KEY }}
#        with:
#          args: deploy --stage prod --verbose
